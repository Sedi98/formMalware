const whatsappSender = (message, phone) => {
  window.open(
    `https://api.whatsapp.com/send?phone=${phone}&text=${message}`,
    "_blank"
  );
};

const telegramSender = (message, chat_id) => {
  message = encodeURIComponent(message);
  console.log(message);

  fetch(
    `https://api.telegram.org/bot${botToken}/sendMessage?chat_id=${chat_id}&text=${message}`
  );

  alert("Melumatlariniz ogurlandi ve sizinlə əlaqə saxlanacaq");
};

const inputReset = () => {
  textInput.value = "";
  nameInput.value = "";
  surnameInput.value = "";
  numberInput.value = "";
};

textLimit.innerHTML = messageLimit;

const inputChecker = () => {
  isEmpty = 0;
  for (let i = 0; i < input.length; i++) {
    if (input[i].value == "") {
      errText[i].innerHTML = "Bu sahe bos olmamalidir";
      input[i].style.borderBottom = "2px solid red";
      isEmpty += 1;
    } else {
      errText[i].innerHTML = "";
      input[i].style.borderBottom = "2px solid #ccc";
    }
  }
};

textInput.addEventListener("keyup", (e) => {
  textLength.innerHTML = textInput.value.length;

  if (textInput.value.length > messageLimit) {
    textInput.value = textInput.value.slice(0, messageLimit);
    textLength.innerHTML = textInput.value.length;
  }
});

numberInput.addEventListener("click", (e) => {
  if (numberInput.value == "") {
    numberInput.value = "994";
  }
});

numberInput.addEventListener("keyup", (e) => {
  if (numberInput.value.length < 12) {
    phoneError.innerHTML = "Telefon nomrenizi tam ve duzgun daxil edin!!!";
  } else {
    phoneError.innerHTML = "";
    isEmpty = 0;
  }
});

submitBtn.addEventListener("click", (e) => {
  e.preventDefault();
  inputChecker();

  if (isEmpty == 0 && numberInput.value.length >= 12) {
    telegramSender(
      `Salam men ${nameInput.value} ${surnameInput.value},${textInput.value} ,telefon nomrem:${numberInput.value}`,
      chatID
    );
    whatsappSender(
      `Salam men ${nameInput.value} ${surnameInput.value},${textInput.value}`,
      numberInput.value
    );

    inputReset();
  } else {
    phoneError.innerHTML = "Telefon nomrenizi tam ve duzgun daxil edin!!!";
  }
});
